# Statistical Inference with Poisson Likelihood and Toy Monte Carlo

This repository contains a Python implementation of a **binned likelihood-based statistical analysis** for signal extraction in the presence of background, inspired by typical workflows in **high-energy physics (HEP)**.

The code simulates signal and background processes, constructs a Poisson likelihood, performs maximum-likelihood estimation of the signal strength parameter, and evaluates hypothesis tests using **toy Monte Carlo experiments**.

---

## Overview

The analysis models an observable \( x \) with:

- **Background (B)**: a smoothly falling exponential distribution  
- **Signal (S)**: a Gaussian resonance on top of the background  

Events are binned into histograms, and inference is performed using a **Poisson likelihood per bin**.

---

## Main Components

### 1. Likelihood Definition

A binned Poisson log-likelihood is defined as

log L(mu) = sum_i [ n_i * log(mu * s_i + b_i) - (mu * s_i + b_i) ]

where:
- n_i are the observed counts per bin
- s_i and b_i are the expected signal and background templates
- mu is the signal strength parameter

This likelihood is implemented in:

- `poisson_likelihood(mu, n, s, b)`

---

### 2. Maximum Likelihood Fit

The signal strength \( \mu \) is estimated by minimizing the negative log-likelihood:

- Physical constraint: \( \mu \ge 0 \)
- Minimization method: **L-BFGS-B**

Implemented in:

- `fit_mu(n, s, b)`

This is used to extract:
- the best-fit value \( \hat{\mu} \),
- the corresponding maximum log-likelihood.

---

### 3. Asimov Dataset Simulation

An **Asimov-like dataset** is generated by:
- sampling background events from an exponential distribution,
- sampling signal events from a Gaussian distribution,
- filling histograms for:
  - background-only,
  - signal-only,
  - signal + background.

The resulting histograms are used to build the signal and background templates.

Output plots:
- `1_sb.pdf` — signal + background
- `2_bonly.pdf` — background only

---

### 4. Measurement Simulation

A pseudo-measurement is generated independently using the same underlying signal and background models.  
The fitted signal strength \( \hat{\mu}_{\text{obs}} \) is obtained by maximizing the likelihood for the observed data.

---

### 5. Hypothesis Testing with Toy Monte Carlo

For a scan of test values \( \mu_{\text{test}} \), the test statistic

\[
q_\mu =
\begin{cases}
0 & \hat{\mu} > \mu \\
-2 \log \frac{\mathcal{L}(\mu)}{\mathcal{L}(\hat{\mu})} & \hat{\mu} \le \mu
\end{cases}
\]

is computed.

For each \( \mu_{\text{test}} \):

1. Toy datasets are generated by Poisson-fluctuating the expected bin counts
2. The test statistic \( q_\mu \) is evaluated for each toy
3. The **p-value** is computed as:

\[
p_\mu = P(q_\mu^{\text{toy}} > q_\mu^{\text{obs}})
\]

The resulting \( q_\mu \) distributions and observed values are saved to:

- `3_q_mu.pdf`

---

## Code Structure

- **Likelihood and fitting**
  - `poisson_likelihood`
  - `fit_mu`
- **Toy Monte Carlo**
  - `generate_toys`
- **Visualization**
  - Histogram plotting
  - Likelihood scans
  - Test statistic distributions

---

## Dependencies

The code requires the following Python packages:

```text
numpy
scipy
matplotlib

